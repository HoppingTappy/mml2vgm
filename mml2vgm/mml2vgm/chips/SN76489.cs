using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace mml2vgm
{
    public class SN76489 : clsChip
    {
        //従来Ver.
        //public new int[] FNumTbl = new int[] {
        //    //   c    c+     d    d+     e     f    f+     g    g+     a    a+     b
        //     0x6AE,0x64E,0x5F4,0x59E,0x54E,0x502,0x4BA,0x476,0x436,0x3F8,0x3C0,0x38A//1
        //    ,0x358,0x328,0x2FB,0x2D0,0x2A8,0x282,0x25E,0x23C,0x21C,0x1FD,0x1E1,0x1C6//2
        //    ,0x1Ab,0x193,0x17c,0x167,0x152,0x13f,0x12d,0x11c,0x10c,0x0Fd,0x0ef,0x0E2//3
        //    ,0x0D3,0x0C8,0x0Bc,0x0B1,0x0A9,0x09e,0x095,0x08d,0x085,0x07d,0x075,0x06f//4
        //    ,0x06b,0x064,0x05e,0x059,0x054,0x04f,0x04a,0x045,0x041,0x03f,0x03b,0x037//5
        //    ,0x035,0x032,0x030,0x02D,0x02A,0x028,0x026,0x024,0x022,0x020,0x01E,0x01C//6
        //    ,0x01B,0x019,0x018,0x016,0x015,0x014,0x013,0x012,0x011,0x010,0x00F,0x00E//7
        //    ,0x00D,0x00D,0x00C,0x00B,0x00B,0x00A,0x009,0x008,0x007,0x006,0x005,0x004//8
        //};

        //耳チューニングVer.
        //public new int[] FNumTbl = new int[] {
        //    //   c    c+     d    d+     e     f    f+     g    g+     a    a+     b
        //     0x6ae,0x64e,0x5f4,0x59e,0x54e,0x502,0x4ba,0x476,0x436,0x3f8,0x3c0,0x38a//1 0x3ff over note is silent 
        //    ,0x357,0x327,0x2fa,0x2cf,0x2a7,0x281,0x25d,0x23b,0x21b,0x1fc,0x1e0,0x1c5//2
        //    ,0x1ac,0x194,0x17d,0x168,0x153,0x140,0x12e,0x11d,0x10d,0x0fe,0x0f0,0x0e3//3
        //    ,0x0d6,0x0ca,0x0be,0x0b4,0x0aa,0x0a0,0x097,0x08f,0x087,0x07f,0x078,0x071//4
        //    ,0x06b,0x065,0x05f,0x05a,0x055,0x050,0x04c,0x047,0x043,0x040,0x03c,0x039//5
        //    ,0x035,0x032,0x030,0x02d,0x02a,0x028,0x026,0x024,0x022,0x020,0x01e,0x01c//6
        //    ,0x01b,0x019,0x018,0x016,0x015,0x014,0x013,0x012,0x011,0x010,0x00f,0x00e//7
        //    ,0x00d,0x00d,0x00c,0x00b,0x00b,0x00a,0x009,0x008,0x007,0x006,0x005,0x004//8
        //};

        // チョコ山さん係数 + a Ver. (OPNA(7987200Hz)SSG -> DCSG)
        protected int[][] _FNumTbl = new int[1][] {
            new int[] {
            //   c    c+     d    d+     e     f    f+     g    g+     a    a+     b
                 0x6AE,0x64E,0x5F4,0x59F,0x54D,0x501,0x4B9,0x476,0x435,0x3F9,0x3C0,0x38A//1
                ,0x357,0x327,0x2FA,0x2CF,0x2A7,0x281,0x25D,0x23B,0x21B,0x1FC,0x1E0,0x1C5//2
                ,0x1AC,0x193,0x17D,0x167,0x154,0x140,0x12E,0x11D,0x10E,0x0FF,0x0F0,0x0E3//3
                ,0x0D6,0x0CA,0x0BE,0x0B4,0x0A9,0x0A0,0x097,0x08F,0x086,0x07F,0x078,0x071//4
                //,0x06B,0x065,0x05F,0x05A,0x055,0x050,0x04B,0x048,0x043,0x040,0x03C,0x038//5
                ,0x06B,0x065,0x05F,0x05A,0x055,0x050,0x04c,0x048,0x044,0x040,0x03C,0x039//5 f+ 0x4B->0x4c  g+ 0x43->0x44  b 0x38->0x39
                //,0x036,0x032,0x030,0x02D,0x02A,0x028,0x026,0x024,0x022,0x01F,0x01E,0x01D//6
                ,0x036,0x032,0x030,0x02D,0x02A,0x028,0x026,0x024,0x022,0x020,0x01E,0x01D//6 a 0x1F->0x20
                //,0x01B,0x019,0x018,0x016,0x016,0x014,0x013,0x012,0x011,0x010,0x00F,0x00E//7
                ,0x01B,0x019,0x018,0x016,0x015,0x014,0x013,0x012,0x011,0x010,0x00F,0x00E//7 e 0x16->0x15
                ,0x00d,0x00d,0x00c,0x00b,0x00b,0x00a,0x009,0x008,0x007,0x006,0x005,0x004//8
            }
        };


        public SN76489(int chipID, string initialPartName) : base(chipID, initialPartName)
        {
            _Name = "SN76489";
            _ShortName = "DCSG";
            _ChMax = 4;
            _canUsePcm = false;
            FNumTbl = _FNumTbl;

            Frequency = 3579545;
            Ch = new clsChannel[ChMax];
            setPartToCh(Ch, initialPartName);
            foreach (clsChannel ch in Ch)
            {
                ch.Type = enmChannelType.DCSG;
                ch.isSecondary = chipID == 1;
            }
            Ch[3].Type = enmChannelType.DCSGNOISE;
        }
    }
}
